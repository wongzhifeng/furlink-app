# å¾®ä¿¡å°ç¨‹åºåŸŸåç™½åå•é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜è¯Šæ–­

### âŒ é”™è¯¯ä¿¡æ¯
```
request:fail url not in domain list
```

### ğŸ”§ é—®é¢˜åˆ†æ
å¾®ä¿¡å°ç¨‹åºå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œåªå…è®¸è°ƒç”¨åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®çš„åˆæ³•åŸŸåã€‚å½“å‰Zeaburåç«¯åŸŸå `https://furlink-backend-us.zeabur.app` æœªæ·»åŠ åˆ°åŸŸåç™½åå•ä¸­ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: é…ç½®åŸŸåç™½åå• (æ¨è)

#### æ­¥éª¤1: ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°
1. è®¿é—® [å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com)
2. ä½¿ç”¨å°ç¨‹åºè´¦å·ç™»å½•

#### æ­¥éª¤2: é…ç½®æœåŠ¡å™¨åŸŸå
1. è¿›å…¥ **å¼€å‘** â†’ **å¼€å‘ç®¡ç†** â†’ **å¼€å‘è®¾ç½®**
2. æ‰¾åˆ° **æœåŠ¡å™¨åŸŸå** éƒ¨åˆ†
3. åœ¨ **requeståˆæ³•åŸŸå** ä¸­æ·»åŠ ï¼š
   ```
   https://furlink-backend-us.zeabur.app
   ```
4. ç‚¹å‡» **ä¿å­˜** æŒ‰é’®

#### æ­¥éª¤3: ç­‰å¾…ç”Ÿæ•ˆ
- åŸŸåé…ç½®éœ€è¦å‡ åˆ†é’Ÿç”Ÿæ•ˆ
- é‡æ–°ç¼–è¯‘å°ç¨‹åºé¡¹ç›®

### æ–¹æ¡ˆ2: å¼€å‘ç¯å¢ƒè·³è¿‡åŸŸåæ ¡éªŒ (ä¸´æ—¶æ–¹æ¡ˆ)

#### åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š
1. ç‚¹å‡»å³ä¸Šè§’ **è¯¦æƒ…** æŒ‰é’®
2. åœ¨ **æœ¬åœ°è®¾ç½®** ä¸­å‹¾é€‰ï¼š
   - âœ… **ä¸æ ¡éªŒåˆæ³•åŸŸåã€web-viewï¼ˆä¸šåŠ¡åŸŸåï¼‰ã€TLS ç‰ˆæœ¬ä»¥åŠ HTTPS è¯ä¹¦**
3. é‡æ–°ç¼–è¯‘é¡¹ç›®

### æ–¹æ¡ˆ3: ä½¿ç”¨ä»£ç†åŸŸå (é«˜çº§æ–¹æ¡ˆ)

å¦‚æœæ— æ³•é…ç½®åŸŸåç™½åå•ï¼Œå¯ä»¥è®¾ç½®ä»£ç†ï¼š

```javascript
// utils/api.js - ä½¿ç”¨ä»£ç†åŸŸå
const API_BASE_URL = 'https://your-proxy-domain.com/api'; // ä»£ç†åŸŸå

// æˆ–è€…ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚æœå°ç¨‹åºéƒ¨ç½²åœ¨åŒä¸€åŸŸåä¸‹ï¼‰
// const API_BASE_URL = '/api';
```

## ğŸš€ ç«‹å³è§£å†³æ­¥éª¤

### 1. å¼€å‘ç¯å¢ƒå¿«é€Ÿè§£å†³
åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š
1. ç‚¹å‡» **è¯¦æƒ…** â†’ **æœ¬åœ°è®¾ç½®**
2. å‹¾é€‰ **ä¸æ ¡éªŒåˆæ³•åŸŸå**
3. é‡æ–°ç¼–è¯‘è¿è¡Œ

### 2. ç”Ÿäº§ç¯å¢ƒé…ç½®
1. ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°
2. æ·»åŠ åŸŸååˆ°ç™½åå•
3. ç­‰å¾…ç”Ÿæ•ˆåæµ‹è¯•

## ğŸ”§ ä»£ç ä¼˜åŒ–

### æ·»åŠ åŸŸåæ£€æŸ¥
```javascript
// utils/api.js - æ·»åŠ åŸŸåæ£€æŸ¥
const API_BASE_URL = 'https://furlink-backend-us.zeabur.app';

// æ£€æŸ¥æ˜¯å¦åœ¨å¼€å‘ç¯å¢ƒ
const isDev = __wxConfig.envVersion === 'develop';

// å¼€å‘ç¯å¢ƒæç¤º
if (isDev) {
  console.log('å¼€å‘ç¯å¢ƒï¼šè¯·ç¡®ä¿å·²å‹¾é€‰"ä¸æ ¡éªŒåˆæ³•åŸŸå"');
}

function request(options) {
  return new Promise((resolve, reject) => {
    wx.request({
      url: API_BASE_URL + options.url,
      method: options.method || 'GET',
      data: options.data || {},
      header: {
        'content-type': 'application/json',
        ...options.header
      },
      timeout: options.timeout || 10000,
      success: function(res) {
        if (res.statusCode === 200) {
          resolve(res);
        } else {
          reject({
            errMsg: `è¯·æ±‚å¤±è´¥: ${res.statusCode}`,
            statusCode: res.statusCode,
            data: res.data
          });
        }
      },
      fail: function(err) {
        // ç‰¹æ®Šå¤„ç†åŸŸåé”™è¯¯
        if (err.errMsg.includes('url not in domain list')) {
          console.error('åŸŸåæœªåœ¨ç™½åå•ä¸­ï¼Œè¯·é…ç½®åŸŸåç™½åå•æˆ–å‹¾é€‰"ä¸æ ¡éªŒåˆæ³•åŸŸå"');
          wx.showModal({
            title: 'åŸŸåé…ç½®æç¤º',
            content: 'è¯·åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®åŸŸåç™½åå•ï¼Œæˆ–åœ¨å¼€å‘è€…å·¥å…·ä¸­å‹¾é€‰"ä¸æ ¡éªŒåˆæ³•åŸŸå"',
            showCancel: false
          });
        }
        reject(err);
      }
    });
  });
}
```

### æ·»åŠ ç¯å¢ƒæ£€æµ‹
```javascript
// utils/env.js - ç¯å¢ƒæ£€æµ‹å·¥å…·
export function getEnvironment() {
  const accountInfo = wx.getAccountInfoSync();
  return {
    envVersion: accountInfo.miniProgram.envVersion, // develop, trial, release
    version: accountInfo.miniProgram.version,
    isDev: accountInfo.miniProgram.envVersion === 'develop',
    isTrial: accountInfo.miniProgram.envVersion === 'trial',
    isRelease: accountInfo.miniProgram.envVersion === 'release'
  };
}

export function checkDomainConfig() {
  const env = getEnvironment();
  
  if (env.isDev) {
    console.log('å¼€å‘ç¯å¢ƒï¼šå»ºè®®å‹¾é€‰"ä¸æ ¡éªŒåˆæ³•åŸŸå"');
    return true;
  } else {
    console.log('ç”Ÿäº§ç¯å¢ƒï¼šè¯·ç¡®ä¿åŸŸåå·²æ·»åŠ åˆ°ç™½åå•');
    return false;
  }
}
```

## ğŸ“‹ é…ç½®æ£€æŸ¥æ¸…å•

### å¼€å‘ç¯å¢ƒ
- [ ] å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­å‹¾é€‰"ä¸æ ¡éªŒåˆæ³•åŸŸå"
- [ ] é‡æ–°ç¼–è¯‘é¡¹ç›®
- [ ] æµ‹è¯•APIè°ƒç”¨

### ç”Ÿäº§ç¯å¢ƒ
- [ ] å¾®ä¿¡å…¬ä¼—å¹³å°æ·»åŠ åŸŸåç™½åå•
- [ ] ç­‰å¾…é…ç½®ç”Ÿæ•ˆï¼ˆé€šå¸¸å‡ åˆ†é’Ÿï¼‰
- [ ] æµ‹è¯•APIè°ƒç”¨
- [ ] å‘å¸ƒå°ç¨‹åº

## ğŸ¯ é¢„æœŸç»“æœ

é…ç½®å®Œæˆåï¼š
- âœ… APIè°ƒç”¨æˆåŠŸ
- âœ… æ•°æ®æ­£å¸¸åŠ è½½
- âœ… é”™è¯¯æç¤ºæ¶ˆå¤±
- âœ… å°ç¨‹åºåŠŸèƒ½æ­£å¸¸

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¦‚æœä»ç„¶å¤±è´¥

#### 1. æ£€æŸ¥åŸŸåæ ¼å¼
- ç¡®ä¿ä½¿ç”¨HTTPSåè®®
- ç¡®ä¿åŸŸåæ ¼å¼æ­£ç¡®
- ç¡®ä¿æ²¡æœ‰å¤šä½™çš„æ–œæ 

#### 2. æ£€æŸ¥é…ç½®çŠ¶æ€
- ç¡®è®¤åŸŸåå·²ä¿å­˜
- ç¡®è®¤é…ç½®å·²ç”Ÿæ•ˆ
- é‡æ–°ç¼–è¯‘é¡¹ç›®

#### 3. æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤ç½‘ç»œæ­£å¸¸
- ç¡®è®¤åŸŸåå¯è®¿é—®
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å¼€å‘é˜¶æ®µ
- ä½¿ç”¨"ä¸æ ¡éªŒåˆæ³•åŸŸå"å¿«é€Ÿå¼€å‘
- åŠæ—¶æµ‹è¯•APIåŠŸèƒ½

### 2. æµ‹è¯•é˜¶æ®µ
- é…ç½®æµ‹è¯•åŸŸå
- è¿›è¡Œå®Œæ•´åŠŸèƒ½æµ‹è¯•

### 3. ç”Ÿäº§é˜¶æ®µ
- é…ç½®æ­£å¼åŸŸå
- ç¡®ä¿åŸŸåå®‰å…¨å¯é 

---

**ç«‹å³è¡ŒåŠ¨**: åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­å‹¾é€‰"ä¸æ ¡éªŒåˆæ³•åŸŸå"ï¼Œç„¶åé‡æ–°ç¼–è¯‘è¿è¡Œï¼
